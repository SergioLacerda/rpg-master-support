<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="css/sheet/styles.css">

    <title>Ficha de Personagem - D&D 3.5</title>

</head>

<body>
    <div class="container">
        <h1>Ficha de Personagem - D&D 3.5</h1>

        <div class="tabs">
            <button class="tab-link active" onclick="openTab(event, 'tab1')">Informações Básicas</button>
            <button class="tab-link" onclick="openTab(event, 'tab2')">Perícias</button>
            <button class="tab-link" onclick="openTab(event, 'tab3')">Talentos</button>
            <button class="tab-link" onclick="openTab(event, 'tab4')">Equipamentos e Inventário</button>
            <button class="tab-link" onclick="openTab(event, 'tab5')">Habilidades de classe</button>
            <button class="tab-link" onclick="openTab(event, 'tab6')">Magias</button>
            <button class="tab-link" onclick="openTab(event, 'tab7')">Dados</button>
        </div>

        <div id="tab1" class="tab-content active">
            <div class="grid-4">
                <div>
                    <label for="nome">Nome</label>
                    <input type="text" id="nome" placeholder="Nome do personagem">
                </div>
                <div>
                    <label for="nivel">Nível</label>
                    <input type="number" id="nivel" placeholder="Nível">
                </div>
                <div>
                    <label for="sexo">Sexo</label>
                    <select id="sexo">
                        <option value="Masculino">Masculino</option>
                        <option value="Feminino">Feminino</option>
                    </select>
                </div>
                <div>
                    <label for="raca">Raça</label>
                    <select id="raca" onchange="updateRacialModifier(this.value)">">
                        <option value="">Selecione</option>
                        <option value="Humano">Humano</option>
                        <option value="Anão">Anão</option>
                        <option value="Elfo">Elfo</option>
                        <option value="Gnomo">Gnomo</option>
                        <option value="Halfling">Halfling</option>
                        <option value="Meio-Elfo">Meio-Elfo</option>
                        <option value="Meio-Orc">Meio-Orc</option>
                    </select>
                </div>
                <div>
                    <label for="idade">Idade</label>
                    <input type="number" id="idade" placeholder="Idade">
                </div>
                <div>
                    <label for="alinhamento">Alinhamento</label>
                    <select id="alinhamento">
                        <option value="Leal e Bom">Leal e Bom</option>
                        <option value="Neutro e Bom">Neutro e Bom</option>
                        <option value="Caótico e Bom">Caótico e Bom</option>
                        <option value="Leal e Neutro">Leal e Neutro</option>
                        <option value="Neutro">Neutro</option>
                        <option value="Caótico e Neutro">Caótico e Neutro</option>
                        <option value="Leal e Mal">Leal e Mal</option>
                        <option value="Neutro e Mal">Neutro e Mal</option>
                        <option value="Caótico e Mal">Caótico e Mal</option>
                    </select>
                </div>
                <div>
                    <label for="classe">Classe</label>
                    <select id="classe">
                        <option value="">Selecione</option>
                        <option value="Bárbaro">Bárbaro</option>
                        <option value="Bardo">Bardo</option>
                        <option value="Clérigo">Clérigo</option>
                        <option value="Druida">Druida</option>
                        <option value="Feiticeiro">Feiticeiro</option>
                        <option value="Guerreiro">Guerreiro</option>
                        <option value="Ladino">Ladino</option>
                        <option value="Mago">Mago</option>
                        <option value="Monge">Monge</option>
                        <option value="Paladino">Paladino</option>
                        <option value="Ranger">Ranger</option>
                    </select>
                </div>
                <div>
                    <label for="divindade">Divindade</label>
                    <input type="text" id="divindade" placeholder="Divindade">
                </div>

            </div>

            <h2>Atributos</h2>

            <div class="grid-6">
                <div>
                    <label for="for">Força</label>
                    <input type="number" id="FOR" placeholder="10" oninput="calcularModificador('FOR')">
                    <small>Mod. Pericia:<span id="strengthSkillModifier" class="spanModifier">0</span></small>
                    <br>
                    <small>--<span id="nodeDividerModifier"></span></small>
                    <br>
                    <small>Mod. Racial: <span id="strengthRaceModifier" class="spanRace">0</span></small>
                    <br>
                    <small>TOTAL: <span id="strengthTotal" class="spanTotal">0</span></small>
                </div>
                <div>
                    <label for="des">Destreza</label>
                    <input type="number" id="DES" placeholder="10" oninput="calcularModificador('DES')">
                    <small>Mod. Pericia:<span id="dexteritySkillModifier">0</span></small>
                    <br>
                    <small>--<span id="nodeDividerModifier"></span></small>
                    <br>
                    <small>Mod. Racial: <span id="dexterityRaceModifier" class="spanRace">0</span></small>
                    <br>
                    <small>TOTAL: <span id="dexterityTotal" class="spanTotal">0</span></small>
                </div>
                <div>
                    <label for="con">Constituição</label>
                    <input type="number" id="CON" placeholder="10" oninput="calcularModificador('CON')">
                    <small>Mod. Pericia:<span id="constitutionSkillModifier">0</span></small>
                    <br>
                    <small>--<span id="nodeDividerModifier"></span></small>
                    <br>
                    <small>Mod. Racial: <span id="constitutionRaceModifier" class="spanRace">0</span></small>
                    <br>
                    <small>TOTAL: <span id="constitutionTotal" class="spanTotal">0</span></small>
                </div>
                <div>
                    <label for="int">Inteligência</label>
                    <input type="number" id="INT" placeholder="10" oninput="calcularModificador('INT')">
                    <small>Mod. Pericia:<span id="intelligenceSkillModifier">0</span></small>
                    <br>
                    <small>--<span id="nodeDividerModifier"></span></small>
                    <br>
                    <small>Mod. Racial: <span id="intelligenceRaceModifier" class="spanRace">0</span></small>
                    <br>
                    <small>TOTAL: <span id="intelligenceTotal" class="spanTotal">0</span></small>
                </div>
                <div>
                    <label for="sab">Sabedoria</label>
                    <input type="number" id="SAB" placeholder="10" oninput="calcularModificador('SAB')">
                    <small>Mod. Pericia:<span id="wisdomSkillModifier">0</span></small>
                    <br>
                    <small>--<span id="nodeDividerModifier"></span></small>
                    <br>
                    <small>Mod. Racial: <span id="wisdomRaceModifier" class="spanRace">0</span></small>
                    <br>
                    <small>TOTAL: <span id="wisdomTotal" class="spanTotal">0</span></small>
                </div>
                <div>
                    <label for="car">Carisma</label>
                    <input type="number" id="CAR" placeholder="10" oninput="calcularModificador('CAR')">
                    <small>Mod. Pericia:<span id="charismaSkillModifier">0</span></small>
                    <br>
                    <small>--<span id="nodeDividerModifier"></span></small>
                    <br>
                    <small>Mod. Racial: <span id="charismaRaceModifier" class="spanRace">0</span></small>
                    <br>
                    <small>TOTAL: <span id="charismaTotal" class="spanTotal">0</span></small>
                </div>
            </div>


            <h2>Resistências</h2>

            <table>
                <thead>
                    <tr>
                        <th>Tipo</th>
                        <th>Bônus Base</th>
                        <th>Mod. Habilidade</th>
                        <th>Mod. Mágico</th>
                        <th>Outros</th>
                        <th>Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Fortitude</td>
                        <td><input type="number" id="bonusBaseFortitude" class="resistencia-bonus"
                                oninput="calcularResistenciaFortitude()"></td>
                        <td class="align-center"><span id="modHabilidadeFortitude">0</span></td>
                        <td><input type="number" id="modMagicoFortitude" class="resistencia-magico"
                                oninput="calcularResistenciaFortitude()"></td>
                        <td><input type="number" id="outrosFortitude" class="resistencia-outros"
                                oninput="calcularResistenciaFortitude()"></td>
                        <td><input type="number" id="totalFortitude" class="resistencia-total" readonly></td>
                    </tr>
                    <tr>
                        <td>Reflexos</td>
                        <td><input type="number" id="bonusBaseReflexos" class="resistencia-bonus"
                                oninput="calcularResistenciaReflexos()"></td>
                        <td class="align-center"><span id="modHabilidadeReflexos">0</span></td>
                        <td><input type="number" id="modMagicoReflexos" class="resistencia-magico"
                                oninput="calcularResistenciaReflexos()"></td>
                        <td><input type="number" id="outrosReflexos" class="resistencia-outros"
                                oninput="calcularResistenciaReflexos()"></td>
                        <td><input type="number" id="totalReflexos" class="resistencia-total" readonly></td>
                    </tr>
                    <tr>
                        <td>Vontade</td>
                        <td><input type="number" id="bonusBaseVontade" class="resistencia-bonus"
                                oninput="calcularResistenciaVontade()"></td>
                        <td class="align-center"><span id="modHabilidadeVontade">0</span></td>
                        <td><input type="number" id="modMagicoVontade" class="resistencia-magico"
                                oninput="calcularResistenciaVontade()"></td>
                        <td><input type="number" id="outrosVontade" class="resistencia-outros"
                                oninput="calcularResistenciaVontade()"></td>
                        <td><input type="number" id="totalVontade" class="resistencia-total" readonly></td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div id="tab2" class="tab-content">

            <div class="tab-box">
                <div class="form-group">
                    <label for="skillPointsAvailable">Pontos disponíveis:</label>
                    <input type="number" id="skillPointsAvailable">
                    <br>
                    <small>Modificador racial: <span id="raceSkillModifier">0</span></small>
                    <br>
                    <small>Ajustes níveis: <span id="levelSkillModifier">0</span></small>
                </div>
            </div>

            <h3>Cadastrar Perícia</h3>

            <div class="tab-box">
                <div class="form-group">
                    <label for="newSkillName">Nome da Perícia:</label>
                    <select id="newSkillName" onchange="updateAbilityModifierDisplay(this.value)"></select>
                </div>

                <div class="form-group">
                    <label for="newSkillValue">Valor da Perícia:</label>

                    <input type="number" id="newSkillValue" placeholder="Ex: 5">
                </div>
                <br>
                <div class="form-group">
                    <button onclick="addNewSkill()">Adicionar Perícia</button>
                    <small>Modificador: <span id="abilityModifierDisplay">0</span></small>
                </div>
                
            </div>

            <ul id="skillList"></ul>

            <div class="form-group">
                <label>
                    <input type="checkbox" id="toggleAllSkillsList" onclick="toggleAllSkillsList()">
                    Mostrar todas as perícias possíveis
                </label>
            </div>

            <ul id="allSkillsList"></ul>
        </div>

        <div id="tab3" class="tab-content">
            <h3>Cadastrar Talentos</h3>

            <div class="tab-box">
                <div class="form-group">
                    <label for="newFeatName">Nome do Talento:</label>
                    <select id="newFeatName"></select>
                </div>

                <br>
                <div class="form-group">
                    <button onclick="addNewFeat()">Adicionar Talento</button>
                </div>
                
            </div>

            <ul id="featList"></ul>

            <div class="form-group">
                <label>
                    <input type="checkbox" id="toggleAllFeatsList" onclick="toggleAllFeatsList()">
                    Mostrar todos os talentos possíveis
                </label>
            </div>

            <div id="allFeatsList"></div>
        </div>

        <div id="tab4" class="tab-content">
            <textarea id="equipamentos" rows="5" placeholder="Lista de equipamentos e itens..."></textarea>

            <h2>Armas de combate</h2>

            <div class="grid-6">
                <div>
                    <label for="weaponDescription">Arma:</label>
                    <input type="text" id="weaponDescription" placeholder="Ex: Espada Longa">
                </div>
                <div>
                    <label for="weaponBonus">Bônus de Ataque:</label>
                    <input type="text" id="weaponBonus" placeholder="Ex: 1d8+2">
                </div>
                <div>
                    <label for="weaponCritical">Crítico:</label>
                    <input type="text" id="weaponCritical" placeholder="Ex: 19-20/x2">
                </div>
                <div>
                    <label for="weaponType">Tipo:</label>
                    <input type="text" id="weaponType" placeholder="Peq. médio ou grande">
                </div>
                <div>
                    <label for="weaponDistance">Distância:</label>
                    <input type="number" id="weaponDistance" placeholder="30m">
                </div>
            </div>

            <button onclick="addWeapon()">Adicionar <i class="fas fa-user-plus"></i></button>

            <ul id="weaponList"></ul>
        </div>

        <div id="tab5" class="tab-content">
            <textarea id="habilidades" rows="5" placeholder="Descrição das habilidades de classe..."></textarea>
        </div>

        <div id="tab6" class="tab-content">
            <textarea id="magias" rows="5" placeholder="Lista de magias conhecidas e memorizadas..."></textarea>
        </div>


        <div id="tab7" class="tab-content">

            <h4>Exportar dados</h4>
            <div class="form-group">
                <button onclick="exportToJson()">Exportar para JSON</button>
            </div>

            <br>

            <h4>Importar dados</h4>
            <div class="form-group">
                <input type="file" id="importJsonFile" accept=".json" style="display: none;"
                    onchange="importFromJson(); updateLabel()" />

                <button type="button" onclick="document.getElementById('importJsonFile').click()">Carregar
                    arquivo</button>
            </div>
        </div>


    </div>

    <script>
        const weapons = [];
        const skillRecords = [];
        const featRecords = [];

        function openTab(evt, tabId) {
            const tabContents = document.querySelectorAll('.tab-content');
            const tabLinks = document.querySelectorAll('.tab-link');

            tabContents.forEach(content => {
                content.classList.remove('active');
            });

            tabLinks.forEach(link => {
                link.classList.remove('active');
            });

            document.getElementById(tabId).classList.add('active');
            evt.currentTarget.classList.add('active');
        }

        /*  ############# 

            CADASTRAR ATRIBUTOS BASE

            ############# 
        */

        function atualizarAtributos(){
            const atributos = ['FOR', 'DES', 'CON', 'INT', 'SAB', 'CAR']
            atributos.forEach(x => calcularModificador(x))

            atualizarResistencias()
        }

        function calcularModificador(atributo) {
            const valorAtributo = parseInt(document.getElementById(atributo).value) || 0;

            switch (atributo) {
                case 'FOR':
                    calculateModifierFinal(valorAtributo, 'strengthRaceModifier', 'strengthSkillModifier', 'strengthTotal');
                    break;
                case 'DES':
                    calculateModifierFinal(valorAtributo, 'dexterityRaceModifier', 'dexteritySkillModifier', 'dexterityTotal');

                    const modificadorReflexo = parseInt(document.getElementById('dexteritySkillModifier').textContent) || 0;
                    document.getElementById('modHabilidadeReflexos').textContent = modificadorReflexo;
                    calcularResistenciaReflexos();
                    break;
                case 'CON':
                    calculateModifierFinal(valorAtributo, 'constitutionRaceModifier', 'constitutionSkillModifier', 'constitutionTotal');

                    const modificadorFortitude = parseInt(document.getElementById('constitutionSkillModifier').textContent) || 0;
                    document.getElementById('modHabilidadeFortitude').textContent = modificadorFortitude;
                    calcularResistenciaFortitude();
                    break;
                case 'INT':
                    calculateModifierFinal(valorAtributo, 'intelligenceRaceModifier', 'intelligenceSkillModifier', 'intelligenceTotal');

                    break;
                case 'SAB':
                    calculateModifierFinal(valorAtributo, 'wisdomRaceModifier', 'wisdomSkillModifier', 'wisdomTotal');

                    const modificadorVontade = parseInt(document.getElementById('wisdomSkillModifier').textContent) || 0;
                    document.getElementById('modHabilidadeVontade').textContent = modificadorVontade;
                    calcularResistenciaVontade();
                    break;
                case 'CAR':
                    calculateModifierFinal(valorAtributo, 'charismaRaceModifier', 'charismaSkillModifier', 'charismaTotal');

                    break;
            }
        }

        function calculateModifierFinal(valorAtributo, raceModifier, skillModifier, attributeTotal){
            const raceModifierValue = parseInt(document.getElementById(raceModifier).textContent) || 0;
            const finalAttribute = Math.floor(valorAtributo + raceModifierValue);
            const newModifier = finalAttribute > 0 ? Math.floor((finalAttribute - 10) / 2) : 0;

            document.getElementById(attributeTotal).textContent = finalAttribute

            document.getElementById(skillModifier).textContent = newModifier;
        }

        function updateRacialModifier(raceName) {
            switch (raceName) {
                case 'Humano':
                    raceModifier(0,0,0,0,0,0);
                    raceSkillModifier(4);
                    break;
                case 'Anão':
                    raceModifier(0,0,2,0,0,-2);
                    break;
                case 'Elfo':
                    raceModifier(0,2,-2,0,0,0);
                    break;
                case 'Gnomo':
                    raceModifier(-2,0,2,0,0,0);
                    break;
                case 'Halfling':
                    raceModifier(-2,2,0,0,0,0);
                    break;
                case 'Meio-Elfo':
                    raceModifier(0,0,0,0,0,0);
                    break;
                case 'Meio-Orc':
                    raceModifier(2,0,0,-2,0,-2);
                    break;
            }
        }

        function raceModifier(strength, dexterity, constitution, intelligence, wisdom, charisma){
            document.getElementById('strengthRaceModifier').textContent = strength;
            document.getElementById('dexterityRaceModifier').textContent = dexterity;
            document.getElementById('constitutionRaceModifier').textContent = constitution;
            document.getElementById('intelligenceRaceModifier').textContent = intelligence;
            document.getElementById('wisdomRaceModifier').textContent = wisdom;
            document.getElementById('charismaRaceModifier').textContent = charisma;

            atualizarAtributos()
        }

        function raceSkillModifier(bonusValue){
            const currentValue = document.getElementById('raceSkillModifier').textContent || 0
            document.getElementById('raceSkillModifier').textContent = Math.floor(currentValue + bonusValue);
        }

        function atualizarResistencias(){
            calcularResistenciaFortitude()
            calcularResistenciaReflexos()
            calcularResistenciaVontade()
        }

        function calcularResistenciaFortitude() {
            calcularResistencia('bonusBaseFortitude', 'modHabilidadeFortitude', 'modMagicoFortitude', 'outrosFortitude', 'totalFortitude')
        }

        function calcularResistenciaReflexos() {
            calcularResistencia('bonusBaseReflexos', 'modHabilidadeReflexos', 'modMagicoReflexos', 'outrosReflexos', 'totalReflexos');
        }

        function calcularResistenciaVontade() {
            calcularResistencia('bonusBaseVontade', 'modHabilidadeVontade', 'modMagicoVontade', 'outrosVontade', 'totalVontade');
        }

        function calcularResistencia(bonusBase, modHabilidade, modMagico, outros, total) {
            const bonusBaseFinal = parseInt(document.getElementById(bonusBase).value) || 0;
            const modHabilidadeFinal = parseInt(document.getElementById(modHabilidade).textContent) || 0;
            const modMagicoFinal = parseInt(document.getElementById(modMagico).value) || 0;
            const outrosFinal = parseInt(document.getElementById(outros).value) || 0;
            const totalFinal = bonusBaseFinal + modHabilidadeFinal + modMagicoFinal + outrosFinal;

            document.getElementById(total).value = totalFinal;
        }

        /*  ############# 

            CADASTRAR PERICIAS 

            ############# 
        */

        //TODO: lidar com calculo de pontos de pericia
        function skillAvailablePoints(playerClass, playerRace, intelligenceSkillModifier, ){
            const basePoints = Math.floor( (classSkillPoints + intelligenceSkillModifier) * 4 ) 
            const finalPoints = basePoints + raceSkillBonus
        }
        
        function skillAvailablePointsleveling(){
            const humansBonus = +1 //um para cada novo nivel
            const humansFirstLevelBonus = +4 //nivel 1
            const finalPoints = basePoints + raceSkillBonus

            // Perícias de Classe -> 1 ponto pra 1
            // perícias fora da classe -> 2 pontos pra 1
        }

        const possibleSkills = [
            { name: 'Acrobacia', modifier: 'Destreza' },
            { name: 'Adestrar Animais', modifier: 'Carisma' },
            { name: 'Arte da Fuga', modifier: 'Destreza' },
            { name: 'Atuação', modifier: 'Carisma' },
            { name: 'Avaliação', modifier: 'Inteligência' },
            { name: 'Blefar', modifier: 'Carisma' },
            { name: 'Cavalgar', modifier: 'Destreza' },
            { name: 'Concentração', modifier: 'Constituição' },
            { name: 'Conhecimento (Arcano)', modifier: 'Inteligência' },
            { name: 'Conhecimento (História)', modifier: 'Inteligência' },
            { name: 'Conhecimento (Geografia)', modifier: 'Inteligência' },
            { name: 'Conhecimento (Natureza)', modifier: 'Inteligência' },
            { name: 'Decifrar Escrita', modifier: 'Inteligência' },
            { name: 'Diplomacia', modifier: 'Carisma' },
            { name: 'Disfarce', modifier: 'Carisma' },
            { name: 'Equilíbrio', modifier: 'Destreza' },
            { name: 'Escalar', modifier: 'Força' },
            { name: 'Esconder-se', modifier: 'Destreza' },
            { name: 'Furtividade', modifier: 'Destreza' },
            { name: 'Identificar Magia', modifier: 'Inteligência' },
            { name: 'Intimidar', modifier: 'Carisma' },
            { name: 'Investigar', modifier: 'Inteligência' },
            { name: 'Lidar com Animais', modifier: 'Carisma' },
            { name: 'Misticismo', modifier: 'Inteligência' },
            { name: 'Natação', modifier: 'Força' },
            { name: 'Observar', modifier: 'Sabedoria' },
            { name: 'Ouvir', modifier: 'Sabedoria' },
            { name: 'Procurar', modifier: 'Inteligência' },
            { name: 'Prestidigitação', modifier: 'Destreza' },
            { name: 'Primeiros Socorros', modifier: 'Sabedoria' },
            { name: 'Rastrear', modifier: 'Sabedoria' },
            { name: 'Sentir Motivação', modifier: 'Sabedoria' },
            { name: 'Sobrevivência', modifier: 'Sabedoria' },
            { name: 'Uso de Cordas', modifier: 'Destreza' }
        ];

        const skillSelect = document.getElementById('newSkillName');

        const skillOption = document.createElement('option');
        skillOption.value = '';
        skillOption.textContent = 'Selecione';
        skillSelect.appendChild(skillOption);

        possibleSkills.forEach(skill => {
            const option = document.createElement('option');
            option.value = skill.name;
            option.textContent = skill.name;
            skillSelect.appendChild(option);
        });

        function updateAbilityModifierDisplay(skillName) {
            const selectedSkill = possibleSkills.find(skill => skill.name.toLowerCase() === skillName.toLowerCase());
            let modifierValue = 0;

            switch (selectedSkill.modifier) {
                case 'Força':
                    modifierValue = document.getElementById('strengthSkillModifier').textContent || 0;
                    break;
                case 'Destreza':
                    modifierValue = document.getElementById('dexteritySkillModifier').textContent || 0;
                    break;
                case 'Constituição':
                    modifierValue = document.getElementById('constitutionSkillModifier').textContent || 0;
                    break;
                case 'Inteligência':
                    modifierValue = document.getElementById('intelligenceSkillModifier').textContent || 0;
                    break;
                case 'Sabedoria':
                    modifierValue = document.getElementById('wisdomSkillModifier').textContent || 0;
                    break;
                case 'Carisma':
                    modifierValue = document.getElementById('charismaSkillModifier').textContent || 0;
                    break;
                default:
                    modifierValue = 0;
            }

            document.getElementById('abilityModifierDisplay').textContent = modifierValue;
        }

        function addNewSkill() {
            const skillName = document.getElementById('newSkillName').value;
            const skillValue = parseInt(document.getElementById('newSkillValue').value) || 0;
            const abilityModifier = parseInt(document.getElementById('abilityModifierDisplay').textContent);

            const totalSkillValue = skillValue + abilityModifier;

            skillRecords.push({
                nome: skillName,
                valor: skillValue,
                modificador: abilityModifier,
                total: totalSkillValue
            });

            displaySkillsList();

            clearSkillForm();
        }

        function displaySkillsList() {
            const skillList = document.getElementById('skillList');
            skillList.innerHTML = '';

            const title = document.createElement('h3');
            title.textContent = 'Pericias cadastradas';
            skillList.before(title);

            skillRecords.forEach(skill => {
                const listItem = document.createElement('li');
                listItem.textContent = 
                `${skill.nome.charAt(0).toUpperCase() + skill.nome.slice(1)}: 
                Valor: ${skill.valor}, 
                Modificador: ${skill.modificador}, 
                Total: ${skill.total}`;
                skillList.appendChild(listItem);
            });
        }

        function toggleAllSkillsList() {
            const allSkillsList = document.getElementById('allSkillsList');
            const isChecked = document.getElementById('toggleAllSkillsList').checked;

            if (isChecked) {
                listAllSkills();
                allSkillsList.style.display = 'block';
            } else {
                allSkillsList.style.display = 'none';
            }
        }

        function listAllSkills() {
            const allSkillsList = document.getElementById('allSkillsList');
            allSkillsList.innerHTML = '';

            possibleSkills.forEach(skill => {
                const listItem = document.createElement('li');
                listItem.textContent = `${skill.name} (${skill.modifier})`;
                allSkillsList.appendChild(listItem);
            });
        }

        function clearSkillForm() {
            document.getElementById('newSkillName').value = 'Selecione';
            document.getElementById('newSkillValue').value = '';
        }

        /*  ############# 

            CADASTRAR TALENTOS 

            ############# 
        */

        const possibleFeats = [
            { grupo: 'Talentos Básicos', 
              talentos: [
                'Acrobático',
                'Ágil',
                'Perceptivo',
                'Afinidade com Animais',
                'Atlético',
                'Prontidão',
                'Fortitude Maior',
                'Vontade de Ferro',
                'Reflexos Rápidos',
                'Persuasivo',
                'Lábia',
                'Tolerância'] },
            { grupo: 'Talentos de Combate', 
              talentos: [
                'Rachar',
                'Especialização em Combate',
                'Reflexos de Combate',
                'Destruir Armas',
                'Ataque Poderoso',
                'Ataque Preciso',
                'Tiro Certeiro',
                'Finta em Combate',
                'Destruir Escudo',
                'Tiro Longo',
                'Combater com Duas Armas',
                'Mira Precisa',
                'Esquiva',
                'Acerto Crítico Aprimorado',
                'Investida Montada',
                'Ataque em Salto',
                'Mira Certeira',
                'Especialização em Arma',
                'Finta Rápida'] },
            { grupo: 'Talentos Relacionados a Armas', 
              talentos: [
                'Proficiência em Armas Simples',
                'Proficiência em Armas Comuns',
                'Foco em Arma',
                'Especialização em Arma',
                'Ataque Poderoso',
                'Ataque Preciso'] },
            { grupo: 'Talentos Relacionados a Armaduras', 
              talentos: [
                'Proficiência em Armaduras Leves',
                'Proficiência em Armaduras Médias',
                'Proficiência em Armaduras Pesadas',
                'Proficiência em Escudo'] },
            { grupo: 'Talentos de Metamagia', 
              talentos: [
                'Magia Ampliada',
                'Magia Acelerada',
                'Magia Maximizada',
                'Magia Estendida',
                'Magia Imóvel',
                'Magia Silenciosa',
                'Magia Sutil',
                'Magia Empoderada'] },
            { grupo: 'Talentos Relacionados a Magias', 
              talentos: [
                'Conjurar em Combate',
                'Aprimorar Invocação',
                'Usar Magia',
                'Usar Magias em Combate',
                'Percepção de Magia'] },
            { grupo: 'Talentos de Criação de Itens', 
              talentos: [
                'Criar Armas e Armaduras Mágicas',
                'Criar Varinha',
                'Criar Cajado',
                'Criar Anel Mágico',
                'Criar Item Maravilhoso',
                'Criar Pergaminho',
                'Preparar Poções',
                'Criar Bastão Mágico'] },
        ]

        const featSelect = document.getElementById('newFeatName');

        const featOption = document.createElement('option');
        featOption.value = '';
        featOption.textContent = 'Selecione';
        featSelect.appendChild(featOption);
        
        possibleFeats.forEach(group => {
            group.talentos.forEach(feat => {
                const option = document.createElement('option');
                option.value = feat;
                option.textContent = feat;
                featSelect.appendChild(option);
            })
            
        });

        function addNewFeat() {
            const featName = document.getElementById('newFeatName').value;

            featRecords.push({ nome: featName });

            displayFeatsList();            

            clearFeatForm();
        }

        function displayFeatsList() {
            const featList = document.getElementById('featList');
            featList.innerHTML = '';

            const title = document.createElement('h3');
            title.textContent = 'Talentos cadastrados';
            featList.before(title);

            skillRecords.forEach(skill => {
                const listItem = document.createElement('li');
                listItem.textContent = `${skill.nome.charAt(0).toUpperCase()}`;
                featList.appendChild(listItem);
            });
        }

        function toggleAllFeatsList() {
            const allFeatsList = document.getElementById('allFeatsList');
            const isChecked = document.getElementById('toggleAllFeatsList').checked;

            if (isChecked) {
                displayAllFeats();
                allFeatsList.style.display = 'block';
            } else {
                allFeatsList.style.display = 'none';
            }
        }

        function displayAllFeats() {
            const featsListDiv = document.getElementById('allFeatsList');
            featsListDiv.innerHTML = '';

            possibleFeats.forEach(group => {
                const groupTitle = document.createElement('h3');
                groupTitle.textContent = group.grupo;
                featsListDiv.appendChild(groupTitle);

                const ul = document.createElement('ul');
                group.talentos.forEach(talento => {
                    const li = document.createElement('li');
                    li.textContent = talento;
                    ul.appendChild(li);
                });
                featsListDiv.appendChild(ul);
            });

            featsListDiv.style.display = 'block';
        }

        function clearFeatForm() {
            document.getElementById('newFeatName').value = 'Selecione';
        }

        /*  ############# 

            CADASTRAR ARMAS 

            ############# 
        */

        function addWeapon() {
            const weaponDescription = document.getElementById('weaponDescription').value;
            const weaponBonus = parseInt(document.getElementById('weaponBonus').value);
            const weaponCritical = document.getElementById('weaponCritical').value;
            const weaponType = document.getElementById('weaponType').value;
            const weaponDistance = parseInt(document.getElementById('weaponDistance').value);

            const weaponDetails = {
                descricao: weaponDescription,
                bonus: weaponBonus,
                critico: weaponCritical,
                tipo: weaponType,
                distancia: weaponDistance
            };

            if (weaponDescription && !isNaN(weaponBonus) && weaponCritical && weaponType && !isNaN(weaponDistance)) {

                weapons.push(weaponDetails);

                displayWeapons();

                clearWeaponInputs();
            }
        }

        function displayWeapons() {
            const weaponList = document.getElementById('weaponList');
            weaponList.innerHTML = '';

            weapons.forEach((weapon, index) => {
                const weaponItem = document.createElement('li');
                weaponItem.innerHTML = `${weapon.descricao} - Bônus: ${weapon.bonus}, Crítico: ${weapon.critico}, Tipo: ${weapon.tipo}, Distância: ${weapon.distancia} 
                                        <button class="removeWeapon" onclick="removeWeapon(${index})">Remover</button>`;
                weaponList.appendChild(weaponItem);
            });
        }

        function clearWeaponInputs() {
            document.getElementById('weaponDescription').value = '';
            document.getElementById('weaponBonus').value = '';
            document.getElementById('weaponCritical').value = '';
            document.getElementById('weaponType').value = '';
            document.getElementById('weaponDistance').value = '';
        }

        function removeWeapon(index) {
            weapons.splice(index, 1);
            displayWeapons();
        }

        /*  ############# 

            EXPORTAR DADOS

            ############# 
        */

        function exportToJson() {
            const data = {
                nome: document.getElementById("nome").value,
                classe: document.getElementById("classe").value,
                nivel: document.getElementById("nivel").value,
                raca: document.getElementById("raca").value,
                alinhamento: document.getElementById("alinhamento").value,
                divindade: document.getElementById("divindade").value,
                sexo: document.getElementById("sexo").value,
                idade: document.getElementById("idade").value,
                atributos: {
                    forca: document.getElementById("FOR").value,
                    destreza: document.getElementById("DES").value,
                    constituicao: document.getElementById("CON").value,
                    inteligencia: document.getElementById("INT").value,
                    sabedoria: document.getElementById("SAB").value,
                    carisma: document.getElementById("CAR").value
                },
                resistencias: {
                    fortitude: {
                        bonusBase: document.getElementById("bonusBaseFortitude").value,
                        modMagico: document.getElementById("modMagicoFortitude").value,
                        outros: document.getElementById("outrosFortitude").value,
                        total: document.getElementById("totalFortitude").value
                    },
                    reflexos: {
                        bonusBase: document.getElementById("bonusBaseReflexos").value,
                        modMagico: document.getElementById("modMagicoReflexos").value,
                        outros: document.getElementById("outrosReflexos").value,
                        total: document.getElementById("totalReflexos").value
                    },
                    vontade: {
                        bonusBase: document.getElementById("bonusBaseVontade").value,
                        modMagico: document.getElementById("modMagicoVontade").value,
                        outros: document.getElementById("outrosVontade").value,
                        total: document.getElementById("totalVontade").value
                    }
                },
                habilidades: document.getElementById("habilidades").value,
                magias: document.getElementById("magias").value,
                equipamentos: document.getElementById("equipamentos").value,
            };

            const jsonString = JSON.stringify(data, null, 4);
            const blob = new Blob([jsonString], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = "personagem.json";
            a.click();
        }

        /*  ############# 

            IMPORTAR DADOS

            ############# 
        */

        function importFromJson() {
            const fileInput = document.getElementById('importJsonFile');
            const file = fileInput.files[0];

            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    try {
                        const data = JSON.parse(e.target.result);
                        preencherFormulario(data);
                    } catch (error) {
                        alert("Erro ao ler o arquivo JSON. Verifique o formato.");
                    }
                };
                reader.readAsText(file);
            }
        }

        function preencherFormulario(data) {
            document.getElementById("nome").value = data.nome || "";
            document.getElementById("classe").value = data.classe || "";
            document.getElementById("nivel").value = data.nivel || "";
            document.getElementById("raca").value = data.raca || "";
            document.getElementById("alinhamento").value = data.alinhamento || "";
            document.getElementById("divindade").value = data.divindade || "";
            document.getElementById("sexo").value = data.sexo || "";
            document.getElementById("idade").value = data.idade || "";

            if (data.atributos) {
                document.getElementById("FOR").value = data.atributos.forca || "";
                document.getElementById("DES").value = data.atributos.destreza || "";
                document.getElementById("CON").value = data.atributos.constituicao || "";
                document.getElementById("INT").value = data.atributos.inteligencia || "";
                document.getElementById("SAB").value = data.atributos.sabedoria || "";
                document.getElementById("CAR").value = data.atributos.carisma || "";
            }

            if (data.resistencias) {
                document.getElementById("bonusBaseFortitude").value = data.resistencias.fortitude.bonusBase || "";
                document.getElementById("modMagicoFortitude").value = data.resistencias.fortitude.modMagico || "";
                document.getElementById("outrosFortitude").value = data.resistencias.fortitude.outros || "";
                document.getElementById("totalFortitude").value = data.resistencias.fortitude.total || "";

                document.getElementById("bonusBaseReflexos").value = data.resistencias.reflexos.bonusBase || "";
                document.getElementById("modMagicoReflexos").value = data.resistencias.reflexos.modMagico || "";
                document.getElementById("outrosReflexos").value = data.resistencias.reflexos.outros || "";
                document.getElementById("totalReflexos").value = data.resistencias.reflexos.total || "";

                document.getElementById("bonusBaseVontade").value = data.resistencias.vontade.bonusBase || "";
                document.getElementById("modMagicoVontade").value = data.resistencias.vontade.modMagico || "";
                document.getElementById("outrosVontade").value = data.resistencias.vontade.outros || "";
                document.getElementById("totalVontade").value = data.resistencias.vontade.total || "";
            }

            document.getElementById("habilidades").value = data.habilidades || "";
            document.getElementById("magias").value = data.magias || "";
            document.getElementById("equipamentos").value = data.equipamentos || "";
        }
    </script>
</body>

</html